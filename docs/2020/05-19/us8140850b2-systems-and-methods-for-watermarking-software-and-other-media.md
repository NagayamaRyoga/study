# US8140850B2 - Systems and methods for watermarking software and other media

- **Date of patent**: 2012/03/20
- **Applicant**: Intertrust Technologies Corp
- **Nations**: US
- **Google Patents**: https://patents.google.com/patent/US8140850B2/

## 概要

複数の静的透かし挿入方法を定義している。

### 4.1. 挿入方法

#### 4.1.1. 新規コンポーネントの追加

##### 4.1.1.1. 未使用コンポーネント

実際には利用されることのないコンポーネントを挿入する。

- 利点: 性能の劣化がない
- 欠点: 変更・削除などの攻撃

コンポーネントには下記のものがある。

- 未使用のデータ: 実行可能ファイルのデータセクションに格納された静的配列のデータ
- 未使用のコード: 実行されることのない命令列
- テーブル、デバッグ情報、リロケーション、パディングの操作: プログラムヘッダー、シンボルテーブル、デバッグ情報、ジャンプテーブル、リロケーションテーブル、インポート/エクスポートテーブル、仮想関数テーブルなど
- PEセクションの追加: 実行可能ファイルに新しいセクションを追加

#### 4.1.1.2. 利用されているコンポーネント

実行時に利用されているが、動作に影響がないような下記のコードやデータに透かしを挿入する。

- NOP様な命令 (null-effect instruction sequence)、即値オペランド、オペコード、メモリアドレス
- 不活性コード: 一部の命令セットアーキテクチャでは同一の命令を複数のbit列で表現できる場合がある

##### null-effect instruction sequence

NOP、PUSH直後のPOPなどの実際の動作に影響を与えない命令列。
利用時は実行効率が低下しないように注意する必要がある。

下記の米国特許で述べられている。

- Ser. No. 09/095,346, "Obfuscation Techniques for Enhancing Software Security," Jun. 9, 1998
- Cohen, "Operating System Protection Through Program Evolution," Computers & Security, vol. 12, no. 6, pp. 565-584 (1993)

#### 4.1.2. 既存コンポーネントの置換および変更

##### 4.1.2.1. デッドコードの置換

関数 (16byte境界でアライメントされることが多い) のためのパディング、RET命令直後のジャンプテーブルなど。

##### 4.1.2.2. 代替命令エンコーディング

- 等価な命令列への変更
- レジスタ再割当てを行うなど。
- 命令フォーマットの操作

    - ディレクションbit
    - 命令プリフィクスbit
    - スケールbit

#### 4.1.3. 透かし入りブーリアン

ブーリアン代数演算や命令列の選択などに透かしを挿入する。

## まとめ

- ソースコードあるいは実行可能ファイルに透かしを挿入する
- 複数の静的透かし挿入手法について述べている
- 特定の言語や命令セットアーキテクチャに依存しない
